// Simple Express application for testing
const express = require('express');
const app = express();
const PORT = process.env.PORT || 3000;
const BASE_PATH = '/dmplayer';

// Basic middleware
app.use(express.json());
app.use(`${BASE_PATH}`, express.static('public'));

// Simple route
app.get(`${BASE_PATH}`, (req, res) => {
  res.send(`
    <html>
      <head>
        <title>DM Player Test</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
          h1 { color: #4CAF50; }
        </style>
      </head>
      <body>
        <h1>DM Player Test Page</h1>
        <p>This is a simple test page to verify that the Express application is running correctly.</p>
        <p>Node.js version: ${process.version}</p>
        <p>Environment: ${process.env.NODE_ENV || 'development'}</p>
        <p>Current time: ${new Date().toString()}</p>
      </body>
    </html>
  `);
});

// Root route
app.get('/', (req, res) => {
  res.send('DM Player is running. Please access the application at <a href="/dmplayer">/dmplayer</a>');
});

// API test route
app.get(`${BASE_PATH}/api/test`, (req, res) => {
  res.json({ 
    success: true, 
    message: 'API is working',
    time: new Date().toString()
  });
});

// Start the server if not being required by another module
if (require.main === module) {
  app.listen(PORT, () => {
    console.log(`Server running on port ${PORT}`);
    console.log(`Application available at http://localhost:${PORT}${BASE_PATH}`);
  });
}

// Export the app for Passenger
module.exports = app;
